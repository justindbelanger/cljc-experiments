(ns ml-conversion.sample-data-workbook)

(comment
  (require '[clojure.string :as string])
  (require '[dk.ative.docjure.spreadsheet :as ss])

  (def features
    '[{:energy-plus-label "EMSOutHeatingDemand", :tf/position 0, :ui/position 0, :tf/training-scale 0.7728748460042951, :tf/training-mean 27.357729660056794, :kind "surrogate-output", :tf/training-variance 0.5973355275861629, :units "J", :feature/translated-id "Heating demand", :feature/id HEATING-DEMAND} {:ui/position 0, :ui/control "categorical", :default "typical VAV", :feature/id HVAC-DELIVERY-SYSTEM-TYPE, :kind "exterior-selection", :notes "controls a set of parameters in a predefined way", :units "n/a", :feature/translated-id "HVAC system"} {:ui/position 0, :ui/control "categorical", :default "Victoria, BC", :feature/id LOCATION, :kind "exterior-context", :units "n/a", :feature/translated-id "Building location"} {:energy-plus-label "North Axis", :tf/position 0, :ui/position 0, :tf/training-max 359.92606386920426, :default 1, :tf/training-scale 104.02631548541432, :ui/control "continuous", :tf/training-mean 179.7791911304746, :kind "surrogate-input", :tf/training-variance 10821.474313470952, :units "degree", :tf/training-min 0.029660055104692287, :feature/translated-id "Building north axis", :feature/id ORIENTATION} {:ui/position 0, :default 0, :feature/id TEDI, :kind "derived-output", :formula "= ('Heating Demand' / 'Floor Area') / 3600000", :units "kWh/m2", :feature/translated-id "Thermal energy demand intensity"} {:ui/position 1, :ui/control "categorical", :default "Medium Office", :feature/id BUILDING-TYPE, :kind "exterior-context", :units "n/a", :feature/translated-id "Building type"} {:ui/position 1, :default 0, :feature/id CEDI, :kind "derived-output", :formula "= ('Cooling Demand' / 'Floor Area') / 3600000", :units "kWh/m2", :feature/translated-id "Cooling energy demand intensity"} {:energy-plus-label "EMSOutCoolingDemand", :tf/position 1, :ui/position 1, :tf/training-scale 0.5438103301400289, :tf/training-mean 28.912551103684994, :kind "surrogate-output", :tf/training-variance 0.29572967516700727, :units "J", :feature/translated-id "Cooling demand", :feature/id COOLING-DEMAND} {:ui/position 1, :ui/control "categorical", :default "conventional boiler/chiller", :feature/id HVAC-PLANT-TYPE, :kind "exterior-selection", :notes "controls a set of parameters in a predefined way", :units "n/a", :feature/translated-id "HVAC plant type"} {:energy-plus-label "Thickness_0", :tf/position 1, :ui/position 1, :tf/training-max 0.9998746182829388, :default 0.16, :tf/training-scale 0.25953856195506975, :ui/control "continuous", :tf/training-mean 0.5491311859380626, :kind "surrogate-input", :notes "0.07-2.84 W/m2K ", :tf/training-variance 0.06736026514170557, :units "m", :tf/training-min 0.1000607911456688, :feature/translated-id "Wall insulation thickness", :feature/id WALL-INSULATION-THICKNESS} {:ui/position 2, :default 0, :feature/id EUI, :kind "derived-output", :formula "= ((SUM('End Uses') - 'PV Generarion') / 'Floor Area') / 3600000", :units "kWh/m2", :feature/translated-id "Energy use intensity"} {:ui/position 2, :ui/control "continuous", :default 1660, :feature/id FLOOR-AREA, :kind "exterior-context", :units "m2", :feature/translated-id "Gross building floor area"} {:energy-plus-label "EMSOutHeatingNG", :tf/position 2, :ui/position 2, :tf/training-scale 1.6634976398145027, :tf/training-mean 25.57879937809372, :kind "surrogate-output", :notes "NG End Uses", :tf/training-variance 2.767224397668421, :units "J", :feature/translated-id "Heating energy use, natural gas", :feature/id HEATING-NG} {:energy-plus-label "Thickness_1", :tf/position 2, :ui/position 2, :tf/training-max 0.7999967371885739, :default 0.32, :tf/training-scale 0.17159146643253886, :ui/control "continuous", :tf/training-mean 0.4990653706815217, :kind "surrogate-input", :tf/training-variance 0.029443631352469114, :units "m", :tf/training-min 0.2001450204220951, :feature/translated-id "Roof insulation thickness", :feature/id ROOF-INSULATION-THICKNESS} {:ui/position 3, :default 0.18, :feature/id GHG-INTENSITY-NG, :kind "exterior-context", :units "kgCO2/kWh", :feature/translated-id "GHG intensity of natural gas"} {:ui/position 3, :default 0, :feature/id GHGI, :kind "derived-output", :formula "= (((SUM('NG End Uses') * 'GHG Intensity - NG') + (SUM('Other End Uses') * 'GHG Intensity - Other') + ((SUM('Elec End Uses')-'PV Generarion') * 'GHG Intensity - Grid')) / 'Floor Area') / 3600000", :units "kgCO2/m2", :feature/translated-id "Greenhouse gas intensity"} {:energy-plus-label "EMSOutHeatingOther", :tf/position 3, :ui/position 3, :tf/training-scale 1.624281379492476, :tf/training-mean 25.559785743936168, :kind "surrogate-output", :notes "Other End Uses", :tf/training-variance 2.6382899997659806, :units "J", :feature/translated-id "Heating energy use, other", :feature/id HEATING-OTHER} {:energy-plus-label "U-Factor", :tf/position 3, :ui/position 3, :tf/training-max 2.499405810408061, :default 2.2, :tf/training-scale 0.4354612152638879, :ui/control "continuous", :tf/training-mean 1.753475930192473, :kind "surrogate-input", :notes "simple glazing properties", :tf/training-variance 0.18962646999910215, :units "(W/m2)/K", :tf/training-min 1.0009313758552276, :feature/translated-id "Window U-value", :feature/id WINDOW-U-VALUE} {:ui/position 4, :default 0, :feature/id GHG-INTENSITY-OTHER, :kind "exterior-context", :units "kgCO2/kWh", :feature/translated-id "GHG intensity of other fuel sources"} {:energy-plus-label "EMSOutHeatingElec", :tf/position 4, :ui/position 4, :tf/training-scale 1.353499649252116, :tf/training-mean 25.30202347479893, :kind "surrogate-output", :notes "Elec End Uses", :tf/training-variance 1.8319613005256012, :units "J", :feature/translated-id "Heating energy use, electricity", :feature/id HEATING-ELEC} {:ui/position 4, :default 0, :feature/id OPERATING-COST, :kind "derived-output", :formula "= (((SUM('NG End Uses') * 'Fuel Price - NG') + (SUM('Other End Uses') * 'Fuel Price - Other') + ((SUM('Elec End Uses')-'PV Generarion') * 'Fuel Price - Grid')) / 'Floor Area') / 3600000", :units "$/m2", :feature/translated-id "Operating cost"} {:energy-plus-label "Solar Heat Gain Coefficient", :tf/position 4, :ui/position 4, :tf/training-max 0.7997217064244639, :default 0.4, :tf/training-scale 0.17464876587589498, :ui/control "continuous", :tf/training-mean 0.49999155565448006, :kind "surrogate-input", :notes "simple glazing properties", :tf/training-variance 0.03050219142197318, :units "ratio", :tf/training-min 0.2002272783520834, :feature/translated-id "Window solar heat gain coefficient", :feature/id WINDOW-SHGC} {:energy-plus-label "EMSOutCoolingElec", :tf/position 5, :ui/position 5, :tf/training-scale 0.7944227839539395, :tf/training-mean 27.136084466237378, :kind "surrogate-output", :notes "Elec End Uses", :tf/training-variance 0.6311075596651277, :units "J", :feature/translated-id "Cooling energy use, electricity", :feature/id COOLING-ELEC} {:energy-plus-label "Thickness_2", :tf/position 5, :ui/position 5, :tf/training-max 0.09995252809786874, :default 0.1, :tf/training-scale 0.02611583122509359, :ui/control "continuous", :tf/training-mean 0.055227525771463205, :kind "surrogate-input", :notes "thermal mass - concrete slab", :tf/training-variance 0.0006820366405775733, :units "m", :tf/training-min 0.010005138439758593, :feature/translated-id "Floor slab mass concrete thickness", :feature/id FLOOR-MASS-THICKNESS} {:ui/position 5, :default 0.02, :feature/id GHG-INTENSITY-GRID, :kind "exterior-context", :units "kgCO2/kWh", :feature/translated-id "GHG intensity of grid electricity"} {:ui/position 6, :default 0.03, :feature/id FUEL-PRICE-NG, :kind "exterior-context", :units "$/kWh", :feature/translated-id "Natural gas fuel price"} {:energy-plus-label "Thickness_3", :tf/position 6, :ui/position 6, :tf/training-max 0.07997258494776051, :default 0.08, :tf/training-scale 0.020222968941421025, :ui/control "continuous", :tf/training-mean 0.04499767174973773, :kind "surrogate-input", :notes "thermal mass - concrete", :tf/training-variance 0.0004089684728056795, :units "m", :tf/training-min 0.010039171805493574, :feature/translated-id "Wall mass concrete thickness", :feature/id WALL-MASS-THICKNESS} {:ui/position 7, :default 0.09, :feature/id FUEL-PRICE-OTHER, :kind "exterior-context", :units "$/kWh", :feature/translated-id "Fuel price of 'other' energy"} {:energy-plus-label "Zone Floor Area per Person", :tf/position 7, :ui/position 7, :tf/training-max 99.9870673492655, :default 25, :tf/training-scale 26.22460617184309, :ui/control "continuous", :tf/training-mean 55.40245546098593, :kind "surrogate-input", :tf/training-variance 687.7299688682707, :units "m2/occ", :tf/training-min 10.042311347977543, :feature/translated-id "Floor area per-person", :feature/id OCCUPANCY} {:ui/position 8, :default 0.08, :feature/id FUEL-PRICE-GRID, :kind "exterior-context", :units "$/kWh", :feature/translated-id "Grid electrity fuel price"} {:energy-plus-label "Watts per Zone Floor Area_0", :tf/position 8, :ui/position 8, :tf/training-max 19.99485778740816, :default 7.5, :tf/training-scale 5.7535428090935445, :ui/control "continuous", :tf/training-mean 10.00346929677341, :kind "surrogate-input", :tf/training-variance 33.103254856072034, :units "W/m2", :tf/training-min 0.006806348459351022, :feature/translated-id "Plug loads", :feature/id PLUG-LOADS} {:energy-plus-label "Design Level", :tf/position 9, :ui/position 9, :tf/training-max 99980.75289270208, :default 50, :tf/training-scale 28937.213742450618, :ui/control "continuous", :tf/training-mean 48913.986285747604, :kind "surrogate-input", :notes "dedicated IT room with FCU", :tf/training-variance 837362339.1762729, :units "W", :tf/training-min 49.372453909727014, :feature/translated-id "Server room power load", :feature/id SERVER-ROOM-LOADS} {:energy-plus-label "Watts per Zone Floor Area_1", :tf/position 10, :ui/position 10, :tf/training-max 14.999011891632032, :default 7.5, :tf/training-scale 3.464898119225973, :ui/control "continuous", :tf/training-mean 9.028677550749546, :kind "surrogate-input", :notes "whole building average", :tf/training-variance 12.005518976615683, :units "W/m2", :tf/training-min 3.004479871538809, :feature/translated-id "Lighting power density", :feature/id LIGHTING-POWER-DENSITY} {:energy-plus-label "Peak Use Flow Rate", :tf/position 11, :ui/position 11, :tf/training-max 0.00019999376714909605, :default 0.0001, :tf/training-scale 0.00004619980775606867, :ui/control "continuous", :tf/training-mean 0.00012061207497517886, :kind "surrogate-input", :tf/training-variance 2.1344222366977033e-9, :units "m3/s", :tf/training-min 0.00004010333318501379, :feature/translated-id "Domestic hot water peak use flow rate", :feature/id DHW} {:energy-plus-label "Flow per Exterior Surface Area", :tf/position 12, :ui/position 12, :tf/training-max 0.0004998278157461174, :default 0.00025, :tf/training-scale 0.0001150442110839987, :ui/control "continuous", :tf/training-mean 0.00030207297121304344, :kind "surrogate-input", :notes "per exterior surface area", :tf/training-variance 1.3235170503939648e-8, :units "(m3/s)/m2", :tf/training-min 0.00010019385747955056, :feature/translated-id "Infiltration rate", :feature/id INFILTRATION-RATE} {:energy-plus-label "Zone Air Distribution Effectiveness in Cooling Mode", :tf/position 13, :ui/position 13, :tf/training-max 1.4997110664987252, :default 1, :tf/training-scale 0.2894884030183191, :ui/control "continuous", :tf/training-mean 0.9964898425144119, :kind "surrogate-input", :notes "OA rate (ratio of min OA)", :tf/training-variance 0.08380353548209674, :units "ratio", :tf/training-min 0.5001303910814787, :feature/translated-id "Air distribution effectiveness in cooling mode", :feature/id VENTILATION-EFFECTIVENESS-CLG} {:energy-plus-label "Zone Air Distribution Effectiveness in Heating Mode", :tf/position 14, :ui/position 14, :tf/training-max 1.4999747631506055, :default 1, :tf/training-scale 0.2880716591436548, :ui/control "continuous", :tf/training-mean 0.9930153450659888, :kind "surrogate-input", :notes "OA rate (ratio of min OA)", :tf/training-variance 0.08298528080177801, :units "ratio", :tf/training-min 0.5005215153158344, :feature/translated-id "Air distribution effectiveness in heating mode", :feature/id VENTILATION-EFFECTIVENESS-HTG} {:energy-plus-label "Value Until Time 2", :tf/position 15, :ui/position 15, :tf/training-max 25.998917211902622, :default 23, :tf/training-scale 1.1204452169286594, :ui/control "continuous", :tf/training-mean 24.05273229216613, :kind "surrogate-input", :tf/training-variance 1.2553974841383104, :units "C", :tf/training-min 22.101196310433803, :feature/translated-id "Cooling setpoint", :feature/id COOLING-SETPOINT} {:energy-plus-label "Hourly Value_0", :tf/position 16, :ui/position 16, :tf/training-max 39.97647472361299, :default 0.3, :tf/training-scale 11.638045922032612, :ui/control "continuous", :tf/training-mean 20.05995698437052, :kind "surrogate-input", :tf/training-variance 135.4441128833399, :units "RH", :tf/training-min 0.024663485417289608, :feature/translated-id "Minimum humidity setpoint", :feature/id MIN-HUMIDITY-SETPOINT} {:energy-plus-label "Hourly Value_1", :tf/position 17, :ui/position 17, :tf/training-max 99.98118391085282, :default 51, :tf/training-scale 14.583149401598918, :ui/control "continuous", :tf/training-mean 75.16396685713705, :kind "surrogate-input", :tf/training-variance 212.66824646935487, :units "RH", :tf/training-min 50.021539811022045, :feature/translated-id "Maximum humidity setpoint", :feature/id MAX-HUMIDITY-SETPOINT} {:energy-plus-label "Coefficient2 x_0", :tf/position 18, :ui/position 18, :tf/training-max 0.9998642376095372, :default 0.494, :tf/training-scale 0.28853887882613494, :ui/control "continuous", :tf/training-mean 0.49422294076004697, :kind "surrogate-input", :tf/training-variance 0.08325468459424298, :units "W/(m3/s)", :tf/training-min 0.0006432880194419653, :feature/translated-id "Fan power", :feature/id FAN-POWER} {:energy-plus-label "Coefficient2 x_1", :tf/position 19, :ui/position 19, :tf/training-max 0.999546612636028, :default 1, :tf/training-scale 0.2901267988255579, :ui/control "continuous", :tf/training-mean 0.500428283724034, :kind "surrogate-input", :notes "ratio convective vs radiant", :tf/training-variance 0.08417355939676574, :units "ratio (of total)", :tf/training-min 0.0006533578922026084, :feature/translated-id "Ratio of convective to radiant air conditioning", :feature/id AIR-SIDE-CONDITIONING-RATIO} {:energy-plus-label "Coefficient2 x_2", :tf/position 20, :ui/position 20, :tf/training-max 5.598285954144036, :default 1.1, :tf/training-scale 1.3245924940713845, :ui/control "continuous", :tf/training-mean 3.2843183589816265, :kind "surrogate-input", :notes "heating plant fuel mix", :tf/training-variance 1.7545452753502506, :units "ratio (of total)", :tf/training-min 1.0025133453592026, :feature/translated-id "Proportion of heating plant fuel v elec", :feature/id HEATING-PLANT-FUEL-ELEC} {:energy-plus-label "Coefficient2 x_3", :tf/position 21, :ui/position 21, :tf/training-max 0.9599678056083312, :default 0.9, :tf/training-scale 0.10450957360396376, :ui/control "continuous", :tf/training-mean 0.7809668251889649, :kind "surrogate-input", :tf/training-variance 0.01092225097488232, :units "ratio (of total)", :tf/training-min 0.6000884417784467, :feature/translated-id "Proportion of heating plant natural gas v other", :feature/id HEATING-FUEL-NG-OTHER} {:energy-plus-label "Coefficient2 x_4", :tf/position 22, :ui/position 22, :tf/training-max 12.396615260191355, :default 1.3, :tf/training-scale 3.2402928667519837, :ui/control "continuous", :tf/training-mean 6.792599576415636, :kind "surrogate-input", :notes "plant performance", :tf/training-variance 10.499497862323787, :units "COP", :tf/training-min 1.2037609388672872, :feature/translated-id "Coefficient of performance plant performance", :feature/id HEATING-PLANT-PERFORMANCE-FUEL} {:energy-plus-label "Window to Wall Ratio", :tf/position 23, :ui/position 23, :tf/training-max 0.8996709503795122, :default 0.4, :tf/training-scale 0.17173873629552397, :ui/control "continuous", :tf/training-mean 0.5959723174281362, :kind "surrogate-input", :tf/training-variance 0.029494193544383526, :units "ratio", :tf/training-min 0.3003015898968382, :feature/translated-id "Window-to-wall ratio", :feature/id WINDOW-TO-WALL-RATIO} {:energy-plus-label "Depth", :tf/position 24, :ui/position 24, :tf/training-max 0.999569485721176, :default 0.01, :tf/training-scale 0.284487458792764, :ui/control "continuous", :tf/training-mean 0.507307783311115, :kind "surrogate-input", :tf/training-variance 0.08093311421036459, :units "m", :tf/training-min 0.010095422840333249, :feature/translated-id "Horizontal shading depth", :feature/id HORIZONTAL-SHADING} {:energy-plus-label "Fraction of Zone Controlled by Reference Point 1", :tf/position 25, :ui/position 25, :tf/training-max 0.999461187979962, :default 0.4, :tf/training-scale 0.2891376222746212, :ui/control "continuous", :tf/training-mean 0.5003817114517307, :kind "surrogate-input", :notes "fraction of lighting controlled", :tf/training-variance 0.08360056461462152, :units "ratio", :tf/training-min 0.0003078435245371156, :feature/translated-id "Fraction of space with daylighting sensors", :feature/id DAYLIGHTING-SENSORS} {:energy-plus-label "Multiplier", :tf/position 26, :ui/position 26, :tf/training-max 19, :default 8, :tf/training-scale 5.509360721132312, :ui/control "discrete", :tf/training-mean 9.983333333333333, :kind "surrogate-input", :notes "Storeys = Multiplier + 2", :tf/training-variance 30.353055555555553, :units "storeys", :tf/training-min 1, :feature/translated-id "Building stories", :feature/id BUILDING-STOREYS} {:energy-plus-label "Sensible Heat Recovery Effectiveness", :tf/position 27, :ui/position 27, :tf/training-max 0.9499246821970488, :default 0.5, :tf/training-scale 0.2755490439910554, :ui/control "continuous", :tf/training-mean 0.47756901879435226, :kind "surrogate-input", :tf/training-variance 0.07592727564438458, :units "eff %", :tf/training-min 0.0006291142814587148, :feature/translated-id "Sensible heat recovery effectiveness", :feature/id SENSIBLE-HEAT-RECOVERY} {:energy-plus-label "Latent Heat Recovery Effectiveness", :tf/position 28, :ui/position 28, :tf/training-max 0.7496165517638049, :default 0.1, :tf/training-scale 0.21733696050557447, :ui/control "continuous", :tf/training-mean 0.372920209094008, :kind "surrogate-input", :tf/training-variance 0.04723535440180164, :units "eff %", :tf/training-min 0.00037671677474362166, :feature/translated-id "Latent heat recovery effectiveness", :feature/id LATENT-HEAT-RECOVERY}])

  (def samples
    '[[HEATING-DEMAND HVAC-DELIVERY-SYSTEM-TYPE LOCATION ORIENTATION TEDI BUILDING-TYPE CEDI COOLING-DEMAND HVAC-PLANT-TYPE WALL-INSULATION-THICKNESS EUI FLOOR-AREA HEATING-NG ROOF-INSULATION-THICKNESS GHG-INTENSITY-NG GHGI HEATING-OTHER WINDOW-U-VALUE GHG-INTENSITY-OTHER HEATING-ELEC OPERATING-COST WINDOW-SHGC COOLING-ELEC FLOOR-MASS-THICKNESS GHG-INTENSITY-GRID FUEL-PRICE-NG WALL-MASS-THICKNESS FUEL-PRICE-OTHER OCCUPANCY FUEL-PRICE-GRID PLUG-LOADS SERVER-ROOM-LOADS LIGHTING-POWER-DENSITY DHW INFILTRATION-RATE VENTILATION-EFFECTIVENESS-CLG VENTILATION-EFFECTIVENESS-HTG COOLING-SETPOINT MIN-HUMIDITY-SETPOINT MAX-HUMIDITY-SETPOINT FAN-POWER AIR-SIDE-CONDITIONING-RATIO HEATING-PLANT-FUEL-ELEC HEATING-FUEL-NG-OTHER HEATING-PLANT-PERFORMANCE-FUEL WINDOW-TO-WALL-RATIO HORIZONTAL-SHADING DAYLIGHTING-SENSORS BUILDING-STOREYS SENSIBLE-HEAT-RECOVERY LATENT-HEAT-RECOVERY]
      [27.47482827365378 "typical VAV" "Victoria, BC" 1 0 "Medium Office" 0 28.44993232521505 "conventional boiler/chiller" 0.16 0 1660 26.718958791760823 0.32 0.18 0 23.297594533234342 2.2 0 26.684039107514682 0 0.4 28.121550566701604 0.1 0.02 0.03 0.08 0.09 25 0.08 7.5 50 7.5 0.0001 0.00025 1 1 23 0.3 51 0.494 1 1.1 0.9 1.3 0.4 0.01 0.4 8 0.5 0.145729244762621]])

  (defn transpose
    "Transposes the 2D matrix `A`,
  for a matrix represented as a vector of vectors."
    [A]
    (apply mapv (fn [& args] (vec args)) A))

  (defn sort-index-series
    "Provides a DataFrame with the Series sorted
  by comparing their labels with `cmp-fn`.

  `cmp-fn` defaults to `compare`.

  Similar to `df.sort_index(axis=1)` in Pandas."
    ([cmp-fn data-frame]
     (->> data-frame
          transpose
          (sort #(cmp-fn (first %1) (first %2)))
          transpose))
    ([data-frame]
     (sort-index-series compare data-frame)))

  (def kind-samples
    (vec
     (transpose
      (sort-by first
               (transpose (vec
                           (cons (mapv (fn [id]
                                         (let [feature (some (fn [feature]
                                                               (when (= id (:feature/id feature))
                                                                 feature))
                                                             features)
                                               kind    (:kind feature)]
                                           kind))
                                       (first samples))
                                 samples)))))))

  (def samples-with-units
    (update kind-samples
            1
            (fn [row]
              (mapv (fn [id]
                      (let [feature (some (fn [feature]
                                            (when (= id (:feature/id feature))
                                              feature))
                                          features)
                            units   (:units feature)]
                        (if (some? units)
                          (str (name id) "-" "(" units ")")
                          (str id))))
                    row))))

  (def humanized-header
    (update samples-with-units
            1
            (fn [row]
              (mapv (fn [id]
                      (-> id
                          (string/replace "-" " ")
                          (string/capitalize)))
                    row))))

  (def workbook
    (apply ss/create-workbook
           (mapcat identity
                   {"Sample data" humanized-header})))

  (ss/save-workbook! "sample_data.xlsx" workbook)

  (println "Done!"))
